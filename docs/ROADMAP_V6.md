# V6 版本规划（Roadmap）

更新时间：2025-08-21 12:49 (Asia/Shanghai)

## M1（近期）- 部分完成
- ✅ __去重与关联口径稳定__：所有路径以订阅目录为边界，避免跨合集。
- ✅ __风控友好默认值__：手动分页（每段100、段间2–4s）、并发=1、视频间5–10s延时、统一 UA/Referer/重试/轻睡眠、SESSDATA-only 支持、列表缓存回退。
- ⏳ __订阅卡片整合__：在订阅页集成"启用/暂停控制自动下载/扫描导入/自动关联/刷新远端总数/状态+日志"。（当前仅有基础静态页面）
- ⏸️ __后端聚合接口（暂缓）__：`GET /api/subscriptions/{id}/dashboard`（只读聚合）与 `GET /api/subscriptions/{id}/events`（SSE）已下调优先级，短期不实现，继续以轮询与现有只读端点为主。
 - ✅ __远端总数统一与前端显隐__：
   - 标准字段统一为 `expected_total`；兼容字段 `remote_total`/`expected_total_videos` 等值返回（deprecated）
   - `/api/subscriptions` 列表返回体已包含 `expected_total` 与可选 `remote_status`
   - 前端仅对 `collection` 类型显示“远端总数（获取/刷新）”控件；渲染优先读取 `expected_total`

## M2（中期）- 优先级调整
- 🚀 __订阅类型扩展__：`uploader` 接入同一任务与导入/关联链路；`keyword` 已接入（待联调与测试）。
  - UP主订阅：B 站 UP 主空间 API 集成，视频列表获取与待下载过滤；`task_manager` 分支与队列入队对齐
  - 关键词订阅：已接入 DB 路径，完善筛选、联调与测试
  - 调度器集成：与现有合集订阅流程统一
  - 增量入队流水线审计与结构化日志完善
  - 端到端集成测试：入队协调器 + 任务管理器 + 去重/并发
- ⏸️ __前端工程化（暂缓）__：迁移至 `web/src/` 与工程化构建暂不推进，短期维持 `web/dist` 静态版与轻量轮询。
- ⏳ __定时任务完善__：自动检查与自动下载开关、间隔配置 UI 化。（基础调度已实现）
- ⏳ __分段/重试可配置__：将 chunk size、段间/视频间延时、整体轻量重试次数暴露为可配置参数。（规划中）
## M3（后续）
- __NFO/封面策略完善__：字段一致性回归；补齐 uniqueid/dateadded/premiered/tags 等。
- __轻量监控__：下载失败数、403/401 次数的统计与 UI 提示。
- __家用增强（可选，暂缓）__：PWA/移动端适配、开机自启、异常提醒。
- __实时能力（可选，暂缓）__：SSE/WebSocket 事件流、Dashboard 聚合等实时可视化能力。

## 风险与策略跟进
- 412/风控响应仅告警不计失败（后端全局中间件/拦截层，待落地）。
- 统一任务状态端点，消除 `/api/tasks/{task_id}/status` 与 `/api/tasks` 差异。
