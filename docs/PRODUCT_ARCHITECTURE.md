# 产品架构（Product Architecture）

更新时间：2025-08-14 13:19 (Asia/Shanghai)

## 1. 产品视图
- 角色：单用户（家庭个人）。
- 入口：Web 订阅管理页（后续可加入移动端 PWA）。
- 核心链路：解析 → 创建订阅 → 定时检查/手动检查 → 自动导入/自动关联 → 下载任务 → 统计刷新 → 媒体库识别。

## 2. 页面/模块
- 订阅列表页：
  - 展示：名称、类型、状态(is_active)、统计(total/downloaded/pending)、远端总数(expected_total)。
  - 操作：开始下载、扫描导入、自动关联、刷新远端总数、编辑、删除。
  - 状态：空闲/检查中/下载中/完成/失败，最近日志若干行。
- 订阅详情（抽屉/单页）：
  - 实时进度条、当前视频、已完成/待下载数、最近日志、历史任务。
  - 定时检查与自动下载开关及间隔设置。

## 3. 数据口径与一致性
- 订阅目录名与下载/导入/关联逻辑完全一致（基于 yt-dlp 合集层级元数据 + 清洗）。
- 统计分离：本地统计 vs 远端 expected_total；避免混淆口径。
- 视频唯一标识：统一使用 `bilibili_id`。

## 4. 使用策略（家用）
- 下载并发=1；检查间隔6–12h；错误重试=2；Cookie 失效显著提示。
- 异常路径清晰：导入/关联一键化，日志可见，必要时再查看容器日志。

## 5. 路线
- M1：整合订阅卡片视图与按钮，聚合接口 dashboard（只读） + events（SSE）。
- M2：UP主/关键词订阅整合；前端构建链路规范化。
- M3：家用自动化完善（开机自启、定时扫描、轻量告警）。
