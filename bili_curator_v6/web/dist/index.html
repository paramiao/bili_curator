<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bili_curator V6</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; }
        .header { background: #00a1d6; color: white; padding: 1rem; text-align: center; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .card { background: white; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .tabs { display: flex; border-bottom: 1px solid #ddd; margin-bottom: 1rem; }
        .tab { padding: 0.5rem 1rem; cursor: pointer; border-bottom: 2px solid transparent; }
        .tab.active { border-bottom-color: #00a1d6; color: #00a1d6; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .btn { background: #00a1d6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; }
        .btn:hover { background: #0084b4; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: bold; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        /* ‰ªªÂä°ÁÆ°ÁêÜÊ†∑Âºè */
        .task-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .task-header h4 {
            margin: 0;
            color: #333;
        }

        .task-controls {
            display: flex;
            gap: 8px;
        }

        .task-info {
            display: flex;
            gap: 16px;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .task-status {
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
        }

        .status-pending .task-status { background-color: #6c757d; }
        .status-checking .task-status { background-color: #17a2b8; }
        .status-downloading .task-status { background-color: #007bff; }
        .status-paused .task-status { background-color: #ffc107; color: #000; }
        .status-completed .task-status { background-color: #28a745; }
        .status-failed .task-status { background-color: #dc3545; }
        .status-cancelled .task-status { background-color: #6c757d; }

        .task-progress {
            color: #666;
        }

        .current-video {
            color: #007bff;
            font-style: italic;
        }

        .progress-bar {
            position: relative;
            background-color: #e9ecef;
            border-radius: 4px;
            height: 20px;
            margin-bottom: 12px;
            overflow: hidden;
        }

        .progress-fill {
            background-color: #007bff;
            height: 100%;
            transition: width 0.3s ease;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: 600;
            color: #333;
        }

        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .task-logs {
            margin-top: 12px;
        }

        .logs-content {
            background-color: #f1f3f4;
            border: 1px solid #e1e3e4;
            border-radius: 4px;
            padding: 12px;
            margin-top: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .log-entry {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #333;
            margin-bottom: 4px;
            white-space: pre-wrap;
        }

        .btn-small {
            padding: 4px 8px;
            font-size: 12px;
        }

        .btn-warning {
            background-color: #ffc107;
            color: #000;
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }

        .btn-success {
            background-color: #28a745;
            color: white;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-info {
            background-color: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background-color: #138496;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #545b62;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid #6c757d;
            color: #6c757d;
        }

        .btn-outline:hover {
            background-color: #6c757d;
            color: white;
        }

        /* Ë°®ÂçïÂ¢ûÂº∫Ê†∑Âºè */
        .form-section {
            margin-top: 20px;
            padding: 16px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .form-section h4 {
            margin: 0 0 16px 0;
            color: #495057;
            font-size: 16px;
        }

        .form-row {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }

        .half-width {
            flex: 1;
        }

        .third-width {
            flex: 1;
        }

        .help-text {
            font-size: 12px;
            color: #6c757d;
            font-weight: normal;
        }

        /* ËÆ¢ÈòÖÁªüËÆ°Ê†∑Âºè */
        .subscription-stats {
            display: flex;
            gap: 16px;
            margin-top: 8px;
            font-size: 14px;
        }

        .stat-item {
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }

        .stat-total {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .stat-downloaded {
            background-color: #e8f5e8;
            color: #2e7d32;
        }

        .stat-pending {
            background-color: #fff3e0;
            color: #f57c00;
        }

        .subscription-item {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            background-color: #fff;
        }

        .subscription-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .subscription-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .subscription-type {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        .type-collection {
            background-color: #007bff;
        }

        .type-uploader {
            background-color: #28a745;
        }

        .type-keyword {
            background-color: #ffc107;
            color: #000;
        }

        .type-specific-urls {
            background-color: #6f42c1;
        }

        .subscription-controls {
            display: flex;
            gap: 8px;
        }

        .subscription-filters {
            margin-top: 8px;
            font-size: 12px;
            color: #6c757d;
        }

        .filter-tag {
            display: inline-block;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 2px 6px;
            margin-right: 6px;
            margin-bottom: 4px;
        }

        .status { padding: 0.5rem; border-radius: 4px; margin-bottom: 1rem; }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .list-item { padding: 0.75rem; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .list-item:last-child { border-bottom: none; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üé¨ bili_curator V6</h1>
        <p>BÁ´ôËßÜÈ¢ë‰∏ãËΩΩÁÆ°ÁêÜÁ≥ªÁªü - ÂÆ∂Áî®ÁÆÄÂåñÁâà</p>
    </div>

    <div class="container">
        <div class="card">
            <div class="tabs">
                <div class="tab active" onclick="showTab('dashboard')">‰ª™Ë°®Êùø</div>
                <div class="tab" onclick="showTab('subscriptions')">ËÆ¢ÈòÖÁÆ°ÁêÜ</div>
                <div class="tab" onclick="showTab('tasks')">‰∏ãËΩΩ‰ªªÂä°</div>
                <div class="tab" onclick="showTab('videos')">ËßÜÈ¢ëÁÆ°ÁêÜ</div>
                <div class="tab" onclick="showTab('cookies')">CookieÁÆ°ÁêÜ</div>
                <div class="tab" onclick="showTab('settings')">Á≥ªÁªüËÆæÁΩÆ</div>
            </div>

            <!-- ‰ª™Ë°®Êùø -->
            <div id="dashboard" class="tab-content active">
                <h2>Á≥ªÁªüÁä∂ÊÄÅ</h2>
                <div id="system-status">Âä†ËΩΩ‰∏≠...</div>
            </div>

            <!-- ËÆ¢ÈòÖÁÆ°ÁêÜ -->
            <div id="subscriptions" class="tab-content">
                <div class="section-header">
                    <h2>ËÆ¢ÈòÖÁÆ°ÁêÜ</h2>
                    <button onclick="showAddSubscription()" class="btn btn-primary">Ê∑ªÂä†ËÆ¢ÈòÖ</button>
                </div>
                <div id="subscription-list"></div>
            </div>
            
            <!-- ‰∏ãËΩΩ‰ªªÂä° -->
            <div id="tasks" class="tab-content">
                <div class="section-header">
                    <h2>‰∏ãËΩΩ‰ªªÂä°</h2>
                    <button onclick="refreshTasks()" class="btn btn-secondary">Âà∑Êñ∞</button>
                    <button onclick="clearCompletedTasks()" class="btn btn-outline">Ê∏ÖÁêÜÂÆåÊàê‰ªªÂä°</button>
                </div>
                <div id="task-list">Âä†ËΩΩ‰∏≠...</div>
            </div>    
                <div id="add-subscription" style="display:none; margin-top:1rem;">
                    <h3>Ê∑ªÂä†Êñ∞ËÆ¢ÈòÖ</h3>
                    <div class="form-group">
                        <label>ËÆ¢ÈòÖÁ±ªÂûã</label>
                        <select id="sub-type" onchange="toggleSubFields()">
                            <option value="collection">ÂêàÈõÜËÆ¢ÈòÖ</option>
                            <option value="uploader">UP‰∏ªËÆ¢ÈòÖ</option>
                            <option value="keyword">ÂÖ≥ÈîÆËØçËÆ¢ÈòÖ</option>
                            <option value="specific-urls">ÁâπÂÆöËßÜÈ¢ëËÆ¢ÈòÖ</option>
                        </select>
                    </div>
                    
                    <!-- ÂêàÈõÜËÆ¢ÈòÖÂ≠óÊÆµ -->
                    <div class="form-group" id="collection-fields">
                        <label>ÂêàÈõÜURL <span class="help-text">Á≤òË¥¥BÁ´ôÂêàÈõÜÈìæÊé•ÔºåÁ≥ªÁªü‰ºöËá™Âä®ËØÜÂà´ÂêçÁß∞</span></label>
                        <input type="text" id="sub-url" placeholder="https://space.bilibili.com/xxx/channel/collectiondetail?sid=xxx" onblur="autoFillCollectionName()">
                    </div>
                    
                    <!-- UP‰∏ªËÆ¢ÈòÖÂ≠óÊÆµ -->
                    <div class="form-group" id="uploader-fields" style="display:none;">
                        <label>UP‰∏ªIDÊàñÂêçÁß∞ <span class="help-text">ËæìÂÖ•UP‰∏ªÁöÑIDÊàñÁî®Êà∑Âêç</span></label>
                        <input type="text" id="sub-uploader" placeholder="UP‰∏ªIDÊàñÁî®Êà∑Âêç">
                    </div>
                    
                    <!-- ÂÖ≥ÈîÆËØçËÆ¢ÈòÖÂ≠óÊÆµ -->
                    <div class="form-group" id="keyword-fields" style="display:none;">
                        <label>ÊêúÁ¥¢ÂÖ≥ÈîÆËØç <span class="help-text">ËæìÂÖ•Ë¶ÅÊêúÁ¥¢ÁöÑÂÖ≥ÈîÆËØç</span></label>
                        <input type="text" id="sub-keyword" placeholder="ÊêúÁ¥¢ÂÖ≥ÈîÆËØç">
                    </div>
                    
                    <!-- ÁâπÂÆöURLÂ≠óÊÆµ -->
                    <div class="form-group" id="specific-urls-fields" style="display:none;">
                        <label>ÁâπÂÆöËßÜÈ¢ëURL <span class="help-text">ÊØèË°å‰∏Ä‰∏™ËßÜÈ¢ëÈìæÊé•</span></label>
                        <textarea id="sub-specific-urls" rows="4" placeholder="https://www.bilibili.com/video/BVxxx&#10;https://www.bilibili.com/video/BVyyy"></textarea>
                    </div>
                    
                    <!-- Á≠õÈÄâÊù°‰ª∂ -->
                    <div class="form-section">
                        <h4>Á≠õÈÄâÊù°‰ª∂ <span class="help-text">ÂèØÈÄâÔºåÁî®‰∫éËøáÊª§‰∏ãËΩΩÁöÑËßÜÈ¢ë</span></h4>
                        
                        <div class="form-row">
                            <div class="form-group half-width">
                                <label>ÂºÄÂßãÊó•Êúü</label>
                                <input type="date" id="sub-date-after">
                            </div>
                            <div class="form-group half-width">
                                <label>ÁªìÊùüÊó•Êúü</label>
                                <input type="date" id="sub-date-before">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group third-width">
                                <label>ÊúÄÂ∞èÁÇπËµûÊï∞</label>
                                <input type="number" id="sub-min-likes" placeholder="0" min="0">
                            </div>
                            <div class="form-group third-width">
                                <label>ÊúÄÂ∞èÊî∂ËóèÊï∞</label>
                                <input type="number" id="sub-min-favorites" placeholder="0" min="0">
                            </div>
                            <div class="form-group third-width">
                                <label>ÊúÄÂ∞èÊí≠ÊîæÊï∞</label>
                                <input type="number" id="sub-min-views" placeholder="0" min="0">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>ËÆ¢ÈòÖÂêçÁß∞</label>
                        <input type="text" id="sub-name" placeholder="Ëá™Âä®ËØÜÂà´ÊàñÊâãÂä®ËæìÂÖ•">
                        <small style="color:#666;">ÂêàÈõÜËÆ¢ÈòÖ‰ºöËá™Âä®ËØÜÂà´‰∏∫"UP‰∏ªÂêçÔºöÂêàÈõÜÂêç"</small>
                    </div>
                    
                    <button class="btn" onclick="addSubscription()">Ê∑ªÂä†ËÆ¢ÈòÖ</button>
                    <button class="btn" onclick="hideAddSubscription()" style="background:#666;">ÂèñÊ∂à</button>
                </div>
            </div>

            <!-- ËßÜÈ¢ëÁÆ°ÁêÜ -->
            <div id="videos" class="tab-content">
                <h2>ËßÜÈ¢ëÁÆ°ÁêÜ</h2>
                <div id="video-list">Âä†ËΩΩ‰∏≠...</div>
            </div>

            <!-- CookieÁÆ°ÁêÜ -->
            <div id="cookies" class="tab-content">
                <h2>CookieÁÆ°ÁêÜ</h2>
                <button class="btn" onclick="showAddCookie()">Ê∑ªÂä†Cookie</button>
                <div id="cookie-list">Âä†ËΩΩ‰∏≠...</div>
                
                <div id="add-cookie" style="display:none; margin-top:1rem;">
                    <h3>Ê∑ªÂä†Êñ∞Cookie</h3>
                    <div class="form-group">
                        <label>CookieÂêçÁß∞</label>
                        <input type="text" id="cookie-name" placeholder="ËæìÂÖ•CookieÂêçÁß∞">
                    </div>
                    <div class="form-group">
                        <label>SESSDATA</label>
                        <input type="text" id="cookie-sessdata" placeholder="ËæìÂÖ•SESSDATAÂÄº">
                    </div>
                    <div class="form-group">
                        <label>bili_jct</label>
                        <input type="text" id="cookie-jct" placeholder="ËæìÂÖ•bili_jctÂÄº">
                    </div>
                    <div class="form-group">
                        <label>DedeUserID</label>
                        <input type="text" id="cookie-userid" placeholder="ËæìÂÖ•DedeUserIDÂÄº">
                    </div>
                    <button class="btn" onclick="addCookie()">Ê∑ªÂä†</button>
                    <button class="btn" onclick="hideAddCookie()" style="background:#666;">ÂèñÊ∂à</button>
                </div>
            </div>

            <!-- Á≥ªÁªüËÆæÁΩÆ -->
            <div id="settings" class="tab-content">
                <h2>Á≥ªÁªüËÆæÁΩÆ</h2>
                <div id="settings-list">Âä†ËΩΩ‰∏≠...</div>
            </div>
        </div>
    </div>

    <script>
        // Ê†áÁ≠æÈ°µÂàáÊç¢
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // Âä†ËΩΩÂØπÂ∫îÊï∞ÊçÆ
            loadTabData(tabName);
        }

        // Âä†ËΩΩÊ†áÁ≠æÈ°µÊï∞ÊçÆ
        function loadTabData(tabName) {
            // ÂàáÊç¢Âà∞Èùû‰ªªÂä°Ê†áÁ≠æÊó∂ÂÅúÊ≠¢ËΩÆËØ¢
            if (tabName !== 'tasks') {
                stopTasksPolling();
            }
            switch(tabName) {
                case 'dashboard': loadDashboard(); break;
                case 'subscriptions': loadSubscriptions(); break;
                case 'tasks': startTasksPolling(); break;
                case 'videos': loadVideos(); break;
                case 'cookies': loadCookies(); break;
                case 'settings': loadSettings(); break;
            }
        }

        // APIËØ∑Ê±ÇÂ∞ÅË£Ö
        async function apiRequest(url, options = {}) {
            try {
                const response = await fetch(url, {
                    headers: { 'Content-Type': 'application/json', ...options.headers },
                    ...options
                });
                return await response.json();
            } catch (error) {
                console.error('APIËØ∑Ê±ÇÂ§±Ë¥•:', error);
                return { error: error.message };
            }
        }

        // Âä†ËΩΩ‰ª™Ë°®Êùø
        async function loadDashboard() {
            const data = await apiRequest('/api/status');
            const html = `
                <div class="status success">
                    <strong>Á≥ªÁªüËøêË°åÊ≠£Â∏∏</strong> - ÁâàÊú¨: ${data.version || '6.0.0'}
                </div>
                <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:1rem;">
                    <div class="card">
                        <h3>ËÆ¢ÈòÖÁªüËÆ°</h3>
                        <p>ÊÄªËÆ¢ÈòÖ: ${data.statistics?.total_subscriptions || 0}</p>
                        <p>Ê¥ªË∑ÉËÆ¢ÈòÖ: ${data.statistics?.active_subscriptions || 0}</p>
                    </div>
                    <div class="card">
                        <h3>ËßÜÈ¢ëÁªüËÆ°</h3>
                        <p>ÊÄªËßÜÈ¢ë: ${data.statistics?.total_videos || 0}</p>
                        <p>Â∑≤‰∏ãËΩΩ: ${data.statistics?.downloaded_videos || 0}</p>
                    </div>
                    <div class="card">
                        <h3>CookieÁä∂ÊÄÅ</h3>
                        <p>ÂèØÁî®Cookie: ${data.statistics?.active_cookies || 0}</p>
                    </div>
                </div>
            `;
            document.getElementById('system-status').innerHTML = html;
        }

        // Âä†ËΩΩËÆ¢ÈòÖÂàóË°®
        async function loadSubscriptions() {
            const result = await apiRequest('/api/subscriptions');
            if (result.error) {
                document.getElementById('subscription-list').innerHTML = `<p class="error">Âä†ËΩΩÂ§±Ë¥•: ${result.error}</p>`;
                return;
            }
            
            let html = '';
            result.forEach(sub => {
                const statusClass = sub.is_active ? 'success' : 'error';
                const statusText = sub.is_active ? 'Ê¥ªË∑É' : 'ÊöÇÂÅú';
                const lastCheck = sub.last_check ? new Date(sub.last_check).toLocaleString() : '‰ªéÊú™';
                
                // ÁªüËÆ°‰ø°ÊÅØ
                const totalVideos = sub.total_videos || 0;
                const downloadedVideos = sub.downloaded_videos || 0;
                const pendingVideos = totalVideos - downloadedVideos;
                
                // ËÆ¢ÈòÖÁ±ªÂûãÊòæÁ§∫
                const typeTexts = {
                    'collection': 'ÂêàÈõÜËÆ¢ÈòÖ',
                    'uploader': 'UP‰∏ªËÆ¢ÈòÖ', 
                    'keyword': 'ÂÖ≥ÈîÆËØçËÆ¢ÈòÖ',
                    'specific-urls': 'ÁâπÂÆöËßÜÈ¢ëËÆ¢ÈòÖ'
                };
                const typeText = typeTexts[sub.type] || sub.type;
                
                // Á≠õÈÄâÊù°‰ª∂ÊòæÁ§∫
                let filtersHtml = '';
                const filters = [];
                if (sub.date_after) filters.push(`ÂºÄÂßãÊó•Êúü: ${sub.date_after}`);
                if (sub.date_before) filters.push(`ÁªìÊùüÊó•Êúü: ${sub.date_before}`);
                if (sub.min_likes) filters.push(`ÊúÄÂ∞èÁÇπËµû: ${sub.min_likes}`);
                if (sub.min_favorites) filters.push(`ÊúÄÂ∞èÊî∂Ëóè: ${sub.min_favorites}`);
                if (sub.min_views) filters.push(`ÊúÄÂ∞èÊí≠Êîæ: ${sub.min_views}`);
                
                if (filters.length > 0) {
                    filtersHtml = `
                        <div class="subscription-filters">
                            Á≠õÈÄâÊù°‰ª∂: ${filters.map(f => `<span class="filter-tag">${f}</span>`).join('')}
                        </div>
                    `;
                }
                
                html += `
                    <div class="subscription-item">
                        <div class="subscription-header">
                            <div>
                                <h3 class="subscription-title">${sub.name}</h3>
                                <span class="subscription-type type-${sub.type}">${typeText}</span>
                            </div>
                            <div class="subscription-controls">
                                <button onclick="downloadSubscription(${sub.id})" class="btn btn-primary">ÂºÄÂßã‰∏ãËΩΩ</button>
                                <button onclick="viewSubscription(${sub.id})" class="btn btn-info">Êü•ÁúãËØ¶ÊÉÖ</button>
                                <button onclick="editSubscription(${sub.id})" class="btn btn-secondary">ÁºñËæë</button>
                                <button onclick="toggleSubscription(${sub.id}, ${sub.is_active})" class="btn ${sub.is_active ? 'btn-warning' : 'btn-success'}">
                                    ${sub.is_active ? 'ÊöÇÂÅú' : 'ÂêØÁî®'}
                                </button>
                                <button onclick="deleteSubscription(${sub.id})" class="btn btn-danger">Âà†Èô§</button>
                            </div>
                        </div>
                        
                        <div class="subscription-stats">
                            <span class="stat-item stat-total">ÊÄªËÆ°: ${totalVideos}</span>
                            <span class="stat-item stat-downloaded">Â∑≤‰∏ãËΩΩ: ${downloadedVideos}</span>
                            <span class="stat-item stat-pending">ÂæÖ‰∏ãËΩΩ: ${pendingVideos}</span>
                        </div>
                        
                        <div style="margin-top: 8px; font-size: 14px; color: #666;">
                            Áä∂ÊÄÅ: ${statusText} | ÊúÄÂêéÊ£ÄÊü•: ${lastCheck}
                        </div>
                        
                        ${filtersHtml}
                    </div>
                `;
            });
            
            document.getElementById('subscription-list').innerHTML = html || '<p>ÊöÇÊó†ËÆ¢ÈòÖ</p>';
        }
        
        // ÂàáÊç¢ËÆ¢ÈòÖÁä∂ÊÄÅ
        async function toggleSubscription(subscriptionId, currentStatus) {
            const newStatus = !currentStatus;
            const result = await apiRequest(`/api/subscriptions/${subscriptionId}`, {
                method: 'PUT',
                body: JSON.stringify({ is_active: newStatus })
            });
            
            if (result.error) {
                alert('Êìç‰ΩúÂ§±Ë¥•: ' + result.error);
            } else {
                loadSubscriptions();
            }
        }

        // ÂàáÊç¢ËÆ¢ÈòÖÁ±ªÂûãÂ≠óÊÆµ
        function toggleSubFields() {
            const type = document.getElementById('sub-type').value;
            
            // ÈöêËóèÊâÄÊúâÂ≠óÊÆµ
            document.getElementById('collection-fields').style.display = 'none';
            document.getElementById('uploader-fields').style.display = 'none';
            document.getElementById('keyword-fields').style.display = 'none';
            document.getElementById('specific-urls-fields').style.display = 'none';
            
            // ÊòæÁ§∫ÂØπÂ∫îÂ≠óÊÆµ
            if (type === 'collection') {
                document.getElementById('collection-fields').style.display = 'block';
            } else if (type === 'uploader') {
                document.getElementById('uploader-fields').style.display = 'block';
            } else if (type === 'keyword') {
                document.getElementById('keyword-fields').style.display = 'block';
            } else if (type === 'specific-urls') {
                document.getElementById('specific-urls-fields').style.display = 'block';
            }
            
            // Ê∏ÖÁ©∫ËÆ¢ÈòÖÂêçÁß∞
            document.getElementById('sub-name').value = '';
        }

        // Ëá™Âä®ËØÜÂà´ÂêàÈõÜÂêçÁß∞
        async function autoFillCollectionName() {
            const url = document.getElementById('sub-url').value;
            if (!url) return;
            
            try {
                // Ë∞ÉÁî®ÂêéÁ´ØAPIËé∑ÂèñÂêàÈõÜ‰ø°ÊÅØ
                const result = await apiRequest('/api/subscriptions/parse-collection', {
                    method: 'POST',
                    body: JSON.stringify({ url })
                });
                
                if (result.name) {
                    document.getElementById('sub-name').value = result.name;
                } else if (result.error) {
                    console.warn('Êó†Ê≥ïËá™Âä®ËØÜÂà´ÂêàÈõÜÂêçÁß∞:', result.error);
                }
            } catch (error) {
                console.warn('Ëá™Âä®ËØÜÂà´ÂêàÈõÜÂêçÁß∞Â§±Ë¥•:', error);
            }
        }

        // ÊòæÁ§∫/ÈöêËóèÊ∑ªÂä†ËÆ¢ÈòÖË°®Âçï
        function showAddSubscription() {
            document.getElementById('add-subscription').style.display = 'block';
            toggleSubFields(); // ÂàùÂßãÂåñÂ≠óÊÆµÊòæÁ§∫
        }
        
        function hideAddSubscription() {
            document.getElementById('add-subscription').style.display = 'none';
            // Ê∏ÖÁ©∫Ë°®Âçï
            document.getElementById('sub-name').value = '';
            document.getElementById('sub-url').value = '';
            document.getElementById('sub-uploader').value = '';
            document.getElementById('sub-keyword').value = '';
        }

        // Ê∑ªÂä†ËÆ¢ÈòÖ
        async function addSubscription() {
            const type = document.getElementById('sub-type').value;
            let name = document.getElementById('sub-name').value;
            
            // Ê†πÊçÆÁ±ªÂûãËé∑ÂèñÁõ∏Â∫îÁöÑÂÄº
            let data = { type };
            
            if (type === 'collection') {
                const url = document.getElementById('sub-url').value;
                if (!url) {
                    alert('ËØ∑ËæìÂÖ•ÂêàÈõÜURL');
                    return;
                }
                data.url = url;
                
                // Â¶ÇÊûúÊ≤°ÊúâÂêçÁß∞ÔºåÂ∞ùËØïËá™Âä®ÁîüÊàê
                if (!name) {
                    name = 'ÂêàÈõÜËÆ¢ÈòÖ - ' + new Date().toLocaleString();
                }
                
            } else if (type === 'uploader') {
                const uploader = document.getElementById('sub-uploader').value;
                if (!uploader) {
                    alert('ËØ∑ËæìÂÖ•UP‰∏ªIDÊàñÂêçÁß∞');
                    return;
                }
                data.uploader_id = uploader;
                
                // Â¶ÇÊûúÊ≤°ÊúâÂêçÁß∞Ôºå‰ΩøÁî®UP‰∏ª‰ø°ÊÅØ
                if (!name) {
                    name = 'UP‰∏ªËÆ¢ÈòÖ - ' + uploader;
                }
                
            } else if (type === 'keyword') {
                const keyword = document.getElementById('sub-keyword').value;
                if (!keyword) {
                    alert('ËØ∑ËæìÂÖ•ÊêúÁ¥¢ÂÖ≥ÈîÆËØç');
                    return;
                }
                data.keyword = keyword;
                
                // Â¶ÇÊûúÊ≤°ÊúâÂêçÁß∞Ôºå‰ΩøÁî®ÂÖ≥ÈîÆËØç
                if (!name) {
                    name = 'ÂÖ≥ÈîÆËØçËÆ¢ÈòÖ - ' + keyword;
                }
                
            } else if (type === 'specific-urls') {
                const specificUrls = document.getElementById('sub-specific-urls').value;
                if (!specificUrls.trim()) {
                    alert('ËØ∑ËæìÂÖ•Ëá≥Â∞ë‰∏Ä‰∏™ËßÜÈ¢ëURL');
                    return;
                }
                
                // Ëß£ÊûêURLÂàóË°®
                const urls = specificUrls.split('\n').map(url => url.trim()).filter(url => url);
                if (urls.length === 0) {
                    alert('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑËßÜÈ¢ëURL');
                    return;
                }
                
                data.specific_urls = JSON.stringify(urls);
                
                // Â¶ÇÊûúÊ≤°ÊúâÂêçÁß∞Ôºå‰ΩøÁî®URLÊï∞Èáè
                if (!name) {
                    name = `ÁâπÂÆöËßÜÈ¢ëËÆ¢ÈòÖ - ${urls.length}‰∏™ËßÜÈ¢ë`;
                }
            }
            
            // Ëé∑ÂèñÁ≠õÈÄâÊù°‰ª∂
            const dateAfter = document.getElementById('sub-date-after').value;
            const dateBefore = document.getElementById('sub-date-before').value;
            const minLikes = document.getElementById('sub-min-likes').value;
            const minFavorites = document.getElementById('sub-min-favorites').value;
            const minViews = document.getElementById('sub-min-views').value;
            
            if (dateAfter) data.date_after = dateAfter;
            if (dateBefore) data.date_before = dateBefore;
            if (minLikes && parseInt(minLikes) > 0) data.min_likes = parseInt(minLikes);
            if (minFavorites && parseInt(minFavorites) > 0) data.min_favorites = parseInt(minFavorites);
            if (minViews && parseInt(minViews) > 0) data.min_views = parseInt(minViews);
            
            data.name = name;
            
            const result = await apiRequest('/api/subscriptions', {
                method: 'POST',
                body: JSON.stringify(data)
            });
            
            if (result.error) {
                alert('Ê∑ªÂä†Â§±Ë¥•: ' + result.error);
            } else {
                alert('Ê∑ªÂä†ÊàêÂäü');
                hideAddSubscription();
                loadSubscriptions();
            }
        }

        // ‰∏ãËΩΩËÆ¢ÈòÖ
        async function downloadSubscription(id) {
            const result = await apiRequest(`/api/subscriptions/${id}/download`, { method: 'POST' });
            if (result.error) {
                alert('ÂêØÂä®‰∏ãËΩΩÂ§±Ë¥•: ' + result.error);
            } else {
                alert('‰∏ãËΩΩ‰ªªÂä°Â∑≤ÂêØÂä®');
                // ÂàáÊç¢Âà∞‰∏ãËΩΩ‰ªªÂä°Ê†áÁ≠æÂπ∂ÂºÄÂßãËΩÆËØ¢
                const tasksTab = Array.from(document.querySelectorAll('.tab')).find(t => t.textContent.includes('‰∏ãËΩΩ‰ªªÂä°'));
                if (tasksTab) {
                    tasksTab.click();
                } else {
                    loadTabData('tasks');
                }
            }
        }

        // ‰ªªÂä°ËΩÆËØ¢‰∏éÊ∏≤Êüì
        let tasksPollTimer = null;

        function startTasksPolling() {
            refreshTasks();
            stopTasksPolling();
            tasksPollTimer = setInterval(refreshTasks, 2000);
        }

        function stopTasksPolling() {
            if (tasksPollTimer) {
                clearInterval(tasksPollTimer);
                tasksPollTimer = null;
            }
        }

        async function refreshTasks() {
            const data = await apiRequest('/api/tasks');
            if (data.error) {
                document.getElementById('task-list').innerHTML = `<p class="error">Âä†ËΩΩÂ§±Ë¥•: ${data.error}</p>`;
                return;
            }
            renderTasks(data);
        }

        function renderTasks(tasks) {
            if (!tasks || tasks.length === 0) {
                document.getElementById('task-list').innerHTML = '<p>ÊöÇÊó†‰ªªÂä°</p>';
                return;
            }
            const statusText = {
                'pending': 'ÊéíÈòü‰∏≠',
                'downloading': '‰∏ãËΩΩ‰∏≠',
                'completed': 'Â∑≤ÂÆåÊàê',
                'failed': 'Â§±Ë¥•',
                'paused': 'Â∑≤ÊöÇÂÅú',
                'cancelled': 'Â∑≤ÂèñÊ∂à'
            };
            const html = tasks.map(t => {
                const progress = typeof t.progress === 'number' ? Math.max(0, Math.min(100, t.progress)) : 0;
                const barClass = t.status === 'completed' ? 'success' : (t.status === 'failed' ? 'error' : '');
                const controls = renderTaskControls(t);
                return `
                    <div class="card" style="margin-bottom:8px;">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div>
                                <strong>‰ªªÂä°#${t.id}</strong>
                                <span style="margin-left:8px;color:#666;">${statusText[t.status] || t.status}</span>
                            </div>
                            <div>${controls}</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress ${barClass}" style="width:${progress}%"></div>
                        </div>
                        ${t.error_message ? `<div class="error">${t.error_message}</div>` : ''}
                        <div style="font-size:12px;color:#666;margin-top:4px;">
                            ÂºÄÂßã: ${t.started_at || '-'} | ÁªìÊùü: ${t.completed_at || '-'}
                        </div>
                    </div>`;
            }).join('');
            document.getElementById('task-list').innerHTML = html;
        }

        function renderTaskControls(t) {
            const buttons = [];
            if (t.status === 'downloading') {
                buttons.push(`<button class="btn btn-warning" onclick="pauseTask('${t.id}')">ÊöÇÂÅú</button>`);
                buttons.push(`<button class="btn btn-danger" onclick="cancelTask('${t.id}')">ÂèñÊ∂à</button>`);
            } else if (t.status === 'paused') {
                buttons.push(`<button class="btn btn-success" onclick="resumeTask('${t.id}')">ÊÅ¢Â§ç</button>`);
                buttons.push(`<button class="btn btn-danger" onclick="cancelTask('${t.id}')">ÂèñÊ∂à</button>`);
            }
            return buttons.join(' ');
        }

        async function pauseTask(taskId) {
            const res = await apiRequest(`/api/tasks/${taskId}/pause`, { method: 'POST' });
            if (res.error) return alert('ÊöÇÂÅúÂ§±Ë¥•: ' + res.error);
            refreshTasks();
        }
        async function resumeTask(taskId) {
            const res = await apiRequest(`/api/tasks/${taskId}/resume`, { method: 'POST' });
            if (res.error) return alert('ÊÅ¢Â§çÂ§±Ë¥•: ' + res.error);
            refreshTasks();
        }
        async function cancelTask(taskId) {
            const res = await apiRequest(`/api/tasks/${taskId}/cancel`, { method: 'POST' });
            if (res.error) return alert('ÂèñÊ∂àÂ§±Ë¥•: ' + res.error);
            refreshTasks();
        }

        async function clearCompletedTasks() {
            const res = await apiRequest('/api/tasks/clear-completed', { method: 'POST' });
            if (res.error) return alert('Ê∏ÖÁêÜÂ§±Ë¥•: ' + res.error);
            refreshTasks();
        }

        // Êü•ÁúãËÆ¢ÈòÖËØ¶ÊÉÖ
        async function viewSubscription(id) {
            const result = await apiRequest(`/api/subscriptions/${id}`);
            if (result.error) {
                alert('Ëé∑ÂèñËÆ¢ÈòÖËØ¶ÊÉÖÂ§±Ë¥•: ' + result.error);
                return;
            }
            
            const sub = result;
            const typeTexts = {
                'collection': 'ÂêàÈõÜËÆ¢ÈòÖ',
                'uploader': 'UP‰∏ªËÆ¢ÈòÖ', 
                'keyword': 'ÂÖ≥ÈîÆËØçËÆ¢ÈòÖ',
                'specific-urls': 'ÁâπÂÆöËßÜÈ¢ëËÆ¢ÈòÖ'
            };
            
            let detailsHtml = `
                <h3>ËÆ¢ÈòÖËØ¶ÊÉÖ</h3>
                <p><strong>ÂêçÁß∞:</strong> ${sub.name}</p>
                <p><strong>Á±ªÂûã:</strong> ${typeTexts[sub.type] || sub.type}</p>
                <p><strong>URL:</strong> ${sub.url}</p>
                <p><strong>Áä∂ÊÄÅ:</strong> ${sub.is_active ? 'Ê¥ªË∑É' : 'ÊöÇÂÅú'}</p>
                <p><strong>ÂàõÂª∫Êó∂Èó¥:</strong> ${new Date(sub.created_at).toLocaleString()}</p>
                <p><strong>ÊúÄÂêéÊ£ÄÊü•:</strong> ${sub.last_check ? new Date(sub.last_check).toLocaleString() : '‰ªéÊú™'}</p>
            `;
            
            if (sub.date_after || sub.date_before || sub.min_likes || sub.min_favorites || sub.min_views) {
                detailsHtml += '<h4>Á≠õÈÄâÊù°‰ª∂:</h4>';
                if (sub.date_after) detailsHtml += `<p>ÂºÄÂßãÊó•Êúü: ${sub.date_after}</p>`;
                if (sub.date_before) detailsHtml += `<p>ÁªìÊùüÊó•Êúü: ${sub.date_before}</p>`;
                if (sub.min_likes) detailsHtml += `<p>ÊúÄÂ∞èÁÇπËµû: ${sub.min_likes}</p>`;
                if (sub.min_favorites) detailsHtml += `<p>ÊúÄÂ∞èÊî∂Ëóè: ${sub.min_favorites}</p>`;
                if (sub.min_views) detailsHtml += `<p>ÊúÄÂ∞èÊí≠Êîæ: ${sub.min_views}</p>`;
            }
            
            // ÂàõÂª∫Ê®°ÊÄÅÊ°ÜÊòæÁ§∫ËØ¶ÊÉÖ
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); display: flex; align-items: center; 
                justify-content: center; z-index: 1000;
            `;
            modal.innerHTML = `
                <div style="background: white; padding: 2rem; border-radius: 8px; max-width: 600px; width: 90%;">
                    ${detailsHtml}
                    <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" class="btn" style="margin-top: 1rem;">ÂÖ≥Èó≠</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // ÁºñËæëËÆ¢ÈòÖ
        async function editSubscription(id) {
            const result = await apiRequest(`/api/subscriptions/${id}`);
            if (result.error) {
                alert('Ëé∑ÂèñËÆ¢ÈòÖ‰ø°ÊÅØÂ§±Ë¥•: ' + result.error);
                return;
            }
            
            const sub = result;
            
            // ÂàõÂª∫ÁºñËæëË°®ÂçïÊ®°ÊÄÅÊ°Ü
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); display: flex; align-items: center; 
                justify-content: center; z-index: 1000; overflow-y: auto;
            `;
            modal.innerHTML = `
                <div style="background: white; padding: 2rem; border-radius: 8px; max-width: 600px; width: 90%; margin: 2rem;">
                    <h3>ÁºñËæëËÆ¢ÈòÖ</h3>
                    <form id="edit-subscription-form">
                        <div class="form-group">
                            <label>ËÆ¢ÈòÖÂêçÁß∞</label>
                            <input type="text" id="edit-name" value="${sub.name}" required>
                        </div>
                        <div class="form-group">
                            <label>ËÆ¢ÈòÖURL</label>
                            <input type="url" id="edit-url" value="${sub.url}" required>
                        </div>
                        <div class="form-group">
                            <label>Áä∂ÊÄÅ</label>
                            <select id="edit-active">
                                <option value="true" ${sub.is_active ? 'selected' : ''}>Ê¥ªË∑É</option>
                                <option value="false" ${!sub.is_active ? 'selected' : ''}>ÊöÇÂÅú</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ÂºÄÂßãÊó•Êúü (ÂèØÈÄâ)</label>
                            <input type="date" id="edit-date-after" value="${sub.date_after || ''}">
                        </div>
                        <div class="form-group">
                            <label>ÁªìÊùüÊó•Êúü (ÂèØÈÄâ)</label>
                            <input type="date" id="edit-date-before" value="${sub.date_before || ''}">
                        </div>
                        <div class="form-group">
                            <label>ÊúÄÂ∞èÁÇπËµûÊï∞ (ÂèØÈÄâ)</label>
                            <input type="number" id="edit-min-likes" value="${sub.min_likes || ''}" min="0">
                        </div>
                        <div class="form-group">
                            <label>ÊúÄÂ∞èÊî∂ËóèÊï∞ (ÂèØÈÄâ)</label>
                            <input type="number" id="edit-min-favorites" value="${sub.min_favorites || ''}" min="0">
                        </div>
                        <div class="form-group">
                            <label>ÊúÄÂ∞èÊí≠ÊîæÊï∞ (ÂèØÈÄâ)</label>
                            <input type="number" id="edit-min-views" value="${sub.min_views || ''}" min="0">
                        </div>
                        <div style="margin-top: 1rem;">
                            <button type="button" onclick="updateSubscription(${id})" class="btn btn-primary">‰øùÂ≠ò</button>
                            <button type="button" onclick="this.closest('div[style*=\"position: fixed\"]').remove()" class="btn btn-secondary" style="margin-left: 0.5rem;">ÂèñÊ∂à</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Êõ¥Êñ∞ËÆ¢ÈòÖ
        async function updateSubscription(id) {
            const formData = {
                name: document.getElementById('edit-name').value,
                url: document.getElementById('edit-url').value,
                is_active: document.getElementById('edit-active').value === 'true',
                date_after: document.getElementById('edit-date-after').value || null,
                date_before: document.getElementById('edit-date-before').value || null,
                min_likes: parseInt(document.getElementById('edit-min-likes').value) || null,
                min_favorites: parseInt(document.getElementById('edit-min-favorites').value) || null,
                min_views: parseInt(document.getElementById('edit-min-views').value) || null
            };
            
            const result = await apiRequest(`/api/subscriptions/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            });
            
            if (result.error) {
                alert('Êõ¥Êñ∞ËÆ¢ÈòÖÂ§±Ë¥•: ' + result.error);
            } else {
                alert('ËÆ¢ÈòÖÊõ¥Êñ∞ÊàêÂäü');
                document.querySelector('div[style*="position: fixed"]').remove();
                loadSubscriptions();
            }
        }

        // Âà†Èô§ËÆ¢ÈòÖ
        async function deleteSubscription(id) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ËÆ¢ÈòÖÂêóÔºü')) return;
            
            const result = await apiRequest(`/api/subscriptions/${id}`, { method: 'DELETE' });
            if (result.error) {
                alert('Âà†Èô§Â§±Ë¥•: ' + result.error);
            } else {
                alert('Âà†Èô§ÊàêÂäü');
                loadSubscriptions();
            }
        }

        // Âä†ËΩΩËßÜÈ¢ëÂàóË°®
        async function loadVideos() {
            const data = await apiRequest('/api/videos');
            const html = data.videos?.map(video => `
                <div class="list-item">
                    <div>
                        <strong>${video.title}</strong>
                        <br><small>UP‰∏ª: ${video.uploader} | Êó∂Èïø: ${video.duration}s</small>
                    </div>
                    <div>
                        <span style="color: ${video.downloaded ? 'green' : 'orange'}">
                            ${video.downloaded ? 'Â∑≤‰∏ãËΩΩ' : 'Êú™‰∏ãËΩΩ'}
                        </span>
                    </div>
                </div>
            `).join('') || '<p>ÊöÇÊó†ËßÜÈ¢ë</p>';
            document.getElementById('video-list').innerHTML = html;
        }

        // Âä†ËΩΩCookieÂàóË°®
        async function loadCookies() {
            const data = await apiRequest('/api/cookies');
            const html = data.map(cookie => `
                <div class="list-item">
                    <div>
                        <strong>${cookie.name}</strong>
                        <br><small>‰ΩøÁî®Ê¨°Êï∞: ${cookie.usage_count} | Áä∂ÊÄÅ: ${cookie.active ? 'Ê¥ªË∑É' : 'Á¶ÅÁî®'}</small>
                    </div>
                    <div>
                        <button class="btn" onclick="validateCookie(${cookie.id})">È™åËØÅ</button>
                        <button class="btn" onclick="deleteCookie(${cookie.id})" style="background:#dc3545;">Âà†Èô§</button>
                    </div>
                </div>
            `).join('');
            document.getElementById('cookie-list').innerHTML = html || '<p>ÊöÇÊó†Cookie</p>';
        }

        // ÊòæÁ§∫/ÈöêËóèÊ∑ªÂä†CookieË°®Âçï
        function showAddCookie() {
            document.getElementById('add-cookie').style.display = 'block';
        }
        function hideAddCookie() {
            document.getElementById('add-cookie').style.display = 'none';
        }

        // Ê∑ªÂä†Cookie
        async function addCookie() {
            const name = document.getElementById('cookie-name').value;
            const sessdata = document.getElementById('cookie-sessdata').value;
            const bili_jct = document.getElementById('cookie-jct').value;
            const dedeuserid = document.getElementById('cookie-userid').value;
            
            if (!name || !sessdata) {
                alert('ËØ∑ËæìÂÖ•CookieÂêçÁß∞ÂíåSESSDATA');
                return;
            }
            
            const data = { name, sessdata, bili_jct, dedeuserid };
            const result = await apiRequest('/api/cookies', {
                method: 'POST',
                body: JSON.stringify(data)
            });
            
            if (result.error) {
                alert('Ê∑ªÂä†Â§±Ë¥•: ' + result.error);
            } else {
                alert('Ê∑ªÂä†ÊàêÂäü');
                hideAddCookie();
                loadCookies();
            }
        }

        // È™åËØÅCookie
        async function validateCookie(id) {
            const result = await apiRequest(`/api/cookies/${id}/validate`, { method: 'POST' });
            alert(result.valid ? 'CookieÊúâÊïà' : 'CookieÊó†Êïà');
            loadCookies();
        }

        // Âà†Èô§Cookie
        async function deleteCookie(id) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™CookieÂêóÔºü')) return;
            
            const result = await apiRequest(`/api/cookies/${id}`, { method: 'DELETE' });
            if (result.error) {
                alert('Âà†Èô§Â§±Ë¥•: ' + result.error);
            } else {
                alert('Âà†Èô§ÊàêÂäü');
                loadCookies();
            }
        }

        // Âä†ËΩΩÁ≥ªÁªüËÆæÁΩÆ
        async function loadSettings() {
            const data = await apiRequest('/api/settings');
            const html = Object.entries(data).map(([key, setting]) => `
                <div class="form-group">
                    <label>${setting.description}</label>
                    <input type="text" value="${setting.value}" onchange="updateSetting('${key}', this.value)">
                </div>
            `).join('');
            document.getElementById('settings-list').innerHTML = html;
        }

        // Êõ¥Êñ∞ËÆæÁΩÆ
        async function updateSetting(key, value) {
            const result = await apiRequest(`/api/settings/${key}`, {
                method: 'PUT',
                body: JSON.stringify({ value })
            });
            
            if (result.error) {
                alert('Êõ¥Êñ∞Â§±Ë¥•: ' + result.error);
            }
        }

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
        });
    </script>
</body>
</html>
