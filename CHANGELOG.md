# 更新日志

## [V6.1.0] - 2025-08-19

### 🆕 新增功能
- **数据一致性服务**：新增 `DataConsistencyService` 类，提供自动数据一致性检查和修复
- **失败视频管理**：订阅管理界面支持失败视频可视化和一键清理
- **数据维护API**：新增 `/api/maintenance/*` 端点，支持一致性检查、报告生成、缓存刷新
- **手动同步增强**：同步操作自动触发数据一致性修复

### 🔧 优化改进
- **远端总数缓存机制**：优化缓存刷新策略，1小时有效期，双层回退机制
- **订阅统计表格**：增加"数据库记录"字段，便于数据一致性监控
- **失败视频显示**：失败数量红色高亮显示，提供清晰的视觉区分
- **待下载数量计算**：基于实时API查询结果，确保数据准确性

### 🐛 问题修复
- 修复远端总数缓存过期导致的数据不准确问题
- 修复订阅统计API中缺失字段的问题
- 优化数据库记录与本地文件数量不一致的检测

### 📚 文档更新
- 更新项目状态文档，反映最新功能和架构变更
- 完善README.md，增加数据维护相关API说明
- 新增CHANGELOG.md，记录版本更新历史

### 🔗 API变更
- 新增 `POST /api/subscriptions/{id}/clear-failed` - 清理失败视频记录
- 新增 `POST /api/maintenance/check-consistency` - 数据一致性检查
- 新增 `POST /api/maintenance/refresh-remote-totals` - 刷新远端总数缓存
- 新增 `GET /api/maintenance/consistency-report` - 获取一致性报告
- 扩展 `GET /api/media/subscription-stats` - 增加 `local_total` 字段

---

## [V6.0.0] - 2025-08-18

### 🚀 重大更新
- **V6架构重构**：全新的现代化Web界面和后端架构
- **统一SPA应用**：包含总览、订阅管理、任务队列、Cookie管理、系统设置、系统监控6大模块
- **Docker一键部署**：单容器部署，零配置启动
- **智能统计系统**：目录统计、订阅统计、系统监控三位一体

### 🌟 核心特性
- **现代化Web管理界面**：告别命令行，全Web操作
- **智能订阅管理**：支持合集、UP主、关键词、特定视频4种订阅类型
- **增强Cookie管理**：Web界面管理，自动轮换，支持会员内容
- **实时任务监控**：任务队列、进度追踪、状态管理
- **数据维护工具**：一致性检查、容量回填、同步缓存管理

### 🛡️ 防风控策略
- **智能限流**：默认并发=1，视频间随机延时5-10s
- **分段抓取**：手动分页，每段100条，段间延时2-4s
- **Cookie轮换**：支持多Cookie池，自动切换失效账号
- **本地缓存回退**：失败时使用本地缓存，减少重复请求

### 📦 技术栈
- **后端**：FastAPI + SQLite + APScheduler + yt-dlp
- **前端**：现代化SPA，统一导航和数据流
- **部署**：Docker Compose，访问地址 http://localhost:8080
